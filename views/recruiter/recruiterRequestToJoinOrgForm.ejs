<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>MT Rec - Détail de la candidature de PRENOM_NOM_CANDIDAT</title>
    <link rel="stylesheet" href="/stylesheets/accueil.css" />
    <link rel="stylesheet" href="/stylesheets/formulaires.css" />

    <!--
    <link rel='stylesheet' href='/stylesheets/connexion.css'>
    <link rel='stylesheet' href='/stylesheets/general.css'>
    -->
  </head>

  <body>
    <header>
      <div class="container">
        <div class="logo">
          <a href="/recruteur/accueilRecruteur"
            ><img src="/images/mt-logo.png" alt="Accueil" class="logo"
          /></a>
        </div>

        <nav>
          <a href="/recruteur/gestionOffresRecruteur/"
            >Gérer vos offres d'emploi</a
          >
          <a href="/recruteur/gestionFichesDePoste"
            >Gérer vos fiches de postes</a
          >
          <a href="/recruteur/demandeRejoindreOrg"
            >Rejoindre une organisation</a
          >
          <a href="/recruteur/monCompteRecruteur">Mon compte</a>
          <a href="/connexion/disconnectUser" class="deconnexion"
            >Deconnexion</a
          >
        </nav>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </header>

    <main class="content">
      <div>
        <div class="disposition_horizontale">
          <div class="formulaire">
            <div class="titre-formulaire">
              <h3>Formulaire pour rejoindre une organisation</h3>
            </div>

            <form
              id="rejoindreOrgForm"
              action="/recruteur/demandeRejoindreOrg"
              method="POST"
            >
              <label for="Organisation">Organisation(Siren, Nom):</label>
              <select id="dropdown_siren" name="dropdown">
                <% organisations.forEach(org => { %>
                <option value="<%= org.siren %>#<%= org.nom %>">
                  <%= org.nom %>
                </option>
                <% }) %>
              </select>

              <!--
                        <label for='Siren'>Siren:</label>
                        <input type='text' id='sirenOrg' name='sirenOrg' required>

                        <label for='Nom'>Nom:</label>
                        <input type='text' id='nameOrg' name='sirenOrg' required>
                        -->

              <label for="Raison">Raison:</label>
              <input type="text" id="raison" name="raison" required />

              <input type="submit" id="submit" value="Envoyer la demande" />
              <input type="reset" id="reset" value="Annuler" />
            </form>
          </div>
          <div class="img_presentation">
            <img
              src="/images/images/landscape-man-canoe-river-freepik.jpg"
              alt="Onboarding Canoe"
              class="img_presentation"
            />
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="logo">
          <img src="/images/mt-logo.png" alt="Logo" class="logo" />
        </div>

        <div class="disposition_verticale">
          <div class="disposition_horizontale">
            <a href="#">A propos de nous</a>
            <a href="#">Nous contacter</a>
          </div>

          <div class="copyright">
            <p>Copyright - MT Rec 2024©</p>
          </div>
        </div>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </footer>
    <script>
      document.getElementById('rejoindreOrgForm').addEventListener('submit', (event) => {
          event.preventDefault();

          const selectedValue = document.getElementById('dropdown_siren').value;
          const [sirenOrg, nameOrg] = selectedValue.split('#');

          formData = {
              sirenOrg: sirenOrg,
              nameOrg: nameOrg,
              raison: document.getElementById('raison').value,
          }

          fetch('/recruteur/demandeRejoindreOrg/addDemande', { // ou  /demande/demandeRejoindreorg
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'Accept': 'application/json',
              },
              body: JSON.stringify(formData),
          })
          .then(response => response.json())
          .then(data => {
              console.log(data);
              if (data.status ===  'success') {
                  alert(data.message);
                  window.location.href = '/recruteur/accueilRecruteur';
              } else {
                  alert(data.error);
              }
          })
          .catch((error) => {
              console.log('Error:' + error);
              alert('Erreur lors de l'envoi de la demande');
          });
      });
    </script>
  </body>
</html>
