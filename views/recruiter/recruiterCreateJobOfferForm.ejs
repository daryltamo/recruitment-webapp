<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>MT Rec - Formulaire de création d'une offre d'emploi</title>
    <link rel="stylesheet" href="/stylesheets/accueil.css" />
    <link rel="stylesheet" href="/stylesheets/formulaires.css" />

    <!--
    <link rel='stylesheet' href='/stylesheets/connexion.css'>
    <link rel='stylesheet' href='/stylesheets/formulaires.css'>
    <link rel='stylesheet' href='/stylesheets/general.css'>
    -->
  </head>

  <body>
    <header>
      <div class="container">
        <div class="logo">
          <a href="/recruteur/accueilRecruteur"
            ><img src="/images/mt-logo.png" alt="Accueil" class="logo"
          /></a>
        </div>

        <nav>
          <a href="/recruteur/gestionOffresRecruteur/"
            >Gérer vos offres d'emploi</a
          >
          <a href="/recruteur/gestionFichesDePoste"
            >Gérer vos fiches de postes</a
          >
          <a href="/recruteur/demandeRejoindreOrg"
            >Rejoindre une organisation</a
          >
          <a href="/recruteur/monCompteRecruteur">Mon compte</a>
          <a href="/connexion/disconnectUser" class="deconnexion"
            >Deconnexion</a
          >
        </nav>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </header>

    <main class="content">
      <div class="disposition_verticale">
        <h2>Formulaire de création d'une offre d'emploi</h2>

        <div class="disposition_horizontale">
          <div class="formulaire">
            <div class="titre-formulaire">
              <h3>Création d'une offre d'emploi</h3>
            </div>

            <form
              id="addOffreDemploiForm"
              action="/recruteur/creationOffre/addOffer"
              method="post"
            >
              <label for="ficheDePoste">Choisissez la fiche de poste:</label>
              <select
                id="dropdown_IdFicheDePoste"
                name="dropdown_IdFicheDePoste"
                required
              >
                <% fichesDePoste.forEach(fiche => { %>
                <option value="<%= fiche.idJobDescription %>">
                  <%= fiche.jobTitle %>
                </option>
                <% }) %>
              </select>

              <label for="Date de fin de validité"
                >Date de fin de validité:</label
              >
              <input
                type="date"
                id="expirationDate"
                name="expirationDate"
                required
              /><br />

              <label for="Indication">Indication:</label>
              <input
                type="text"
                id="indication"
                name="indication"
                required
              /><br />

              <label for="Documents requis">Nombre documents requis:</label>
              <input
                type="text"
                id="numberOfRequiredDocuments"
                name="numberOfRequiredDocuments"
                required
              /><br />

              <label for="Etat">Etat:</label>
              <select
                id="dropdown_etatOffre"
                name="dropdown_etatOffre"
                required
              >
                <option value="non_publié">Non publiée</option>
                <option value="non_publiée">Publiée</option>
              </select>

              <input type="submit" id="submit" name="submit" value="Créer" />
              <input type="reset" id="reset" name="reset" value="Effacer" />
            </form>
          </div>

          <div class="img_presentation">
            <img
              src="/images/bureau_connexion.png"
              alt="Bureau"
              class="img_presentation"
            />
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="logo">
          <img src="/images/mt-logo.png" alt="Logo" class="logo" />
        </div>

        <div class="disposition_verticale">
          <div class="disposition_horizontale">
            <a href="#">A propos de nous</a>
            <a href="#">Nous contacter</a>
          </div>

          <div class="copyright">
            <p>Copyright - MT Rec 2024©</p>
          </div>
        </div>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </footer>

    <script>
      document
        .getElementById("addOffreDemploiForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Empêcher la soumission normale du formulaire

          // Récupérer les valeurs du formulaire
          var formData = {
            idJobDescription: document.getElementById("dropdown_IdFicheDePoste")
              .value,
            expirationDate: document.getElementById("expirationDate").value,
            indication: document.getElementById("indication").value,
            numberOfRequiredDocuments: document.getElementById(
              "numberOfRequiredDocuments"
            ).value,
            state: document.getElementById("dropdown_etatOffre").value,
          };

          // Envoi des données du formulaire en utilisant fetch API
          fetch("/recruteur/creationOffre/addOffer", {
            method: "POST",
            headers: {
              "content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);

              if (data.status === "success") {
                alert("offre d'emploi enregistree avec succès !");
                window.location.href = "/recruteur/gestionOffresRecruteur";
              } else {
                alert(
                  "Erreur survenue lors de l'enregistrement de l'offre d'emploi."
                );
                // window.location.href = '/recruteur/gestionOffresRecruteur';
              }
            })
            .catch((error) => {
              console.log("Error:", error);

              alert("Erreur lors de l'enregistrement de l'offre d'emploi.");
              // window.location.href = '/recruteur/gestionOffresRecruteur';
            });
        });
    </script>
  </body>
</html>
