<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />

    <title>MT Rec - Candidature à l'offre d'emploi INDICATION_OFFRE</title>
    <link rel="stylesheet" href="/stylesheets/accueil.css" />
    <!--
    <link rel='stylesheet' href='/stylesheets/connexion.css'>
    <link rel='stylesheet' href='/stylesheets/formulaires.css'>
    <link rel='stylesheet' href='/stylesheets/general.css'>
    -->
  </head>

  <body>
    <header>
      <div class="container">
        <div class="logo">
          <a href="/recruteur/accueilRecruteur"
            ><img src="/images/mt-logo.png" alt="Accueil" class="logo"
          /></a>
        </div>

        <nav>
          <a href="/recruteur/gestionOffresRecruteur/"
            >Gérer vos offres d'emploi</a
          >
          <a href="/recruteur/gestionFichesDePoste"
            >Gérer vos fiches de postes</a
          >
          <a href="/recruteur/demandeRejoindreOrg"
            >Rejoindre une organisation</a
          >
          <a href="/recruteur/monCompteRecruteur">Mon compte</a>
          <a href="/connexion/disconnectUser" class="deconnexion"
            >Deconnexion</a
          >
        </nav>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </header>

    <main class="content">
      <div>
        <div class="disposition_verticale">
          <div class="tableau">
            <div class="titre-tableau">
              <h3><%= title %></h3>
            </div>

            <table border="1">
              <thead>
                <th>ID Offre D'emploi</th>
                <th>ID Candidat</th>
                <th>Date Candidature</th>
                <th>Actions</th>
              </thead>

              <tbody>
                <% candidatures.forEach(function(candidature) { %>
                <tr>
                  <td><%= candidature.idJobOffer %></td>
                  <td><%= candidature.idApplicant %></td>
                  <td>
                    <%= candidature.applicationDate.toLocaleDateString('fr-FR')
                    %>
                  </td>
                  <td>
                    <button
                      class="btn btn-outline btn-warning"
                      onclick="accepterCandidature("
                      <%="candidature.idApplicant"
                      %
                    >
                      ', '<%= candidature.idJobOffer %>')'> Accepter
                    </button>
                    <button
                      class="btn btn-outline btn-success"
                      onclick="refuserCandidature("
                      <%="candidature.idApplicant"
                      %
                    >
                      ', '<%= candidature.idJobOffer %>')'> Refuser
                    </button>
                    <button
                      class="btn btn-outline btn-warning"
                      onclick="consulterCandidature("
                      <%="candidature.idApplicant"
                      %
                    >
                      ', '<%= candidature.idJobOffer %>')'> Consulter
                    </button>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="logo">
          <img src="/images/mt-logo.png" alt="Logo" class="logo" />
        </div>

        <div class="disposition_verticale">
          <div class="disposition_horizontale">
            <a href="#">A propos de nous</a>
            <a href="#">Nous contacter</a>
          </div>

          <div class="copyright">
            <p>Copyright - MT Rec 2024©</p>
          </div>
        </div>
      </div>
      <!-- TODO: check footer and header consistency and uniformity accross all pages -->
    </footer>

    <script>
      function accepterCandidature(idApplicant, idJobOffer) {
        window.location.href =
          "/recruteur/accepterCandidature/" + idApplicant + "/" + idJobOffer;
      }

      function refuserCandidature(idApplicant, idJobOffer) {
        window.location.href =
          "/recruteur/refuserCandidature/" + idApplicant + "/" + idJobOffer;
      }

      function consulterCandidature(idApplicant, idJobOffer) {
        formData = {
          idApplicant: idApplicant,
          idJobOffer: idJobOffer,
        };

        fetch(
          "/recruteur/detailCandidatureRecruteur/" +
            idApplicant +
            "/" +
            idJobOffer,
          {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          }
        ).catch((error) => {
          console.log(error);
          alert("Erreur, vous ne pouvez pas consulter la candidature");
        });
      }
    </script>
  </body>
</html>
